<?xml version="1.0"?>
<!-- Minimal 2-servo arm, all joints rotate around X axis -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="two_servo_simple">

    <!-- Declare prefix argument (default empty) -->
    <xacro:arg name="prefix" default="" />

    <!-- Parameters -->
    <xacro:property name="servo_size" value="0.025 0.035 0.0455" />
    <xacro:property name="plate_size" value="0.03 0.002 0.110" />

    <!-- Materials -->
    <material name="black">
        <color rgba="0.05 0.05 0.05 1.0" />
    </material>
    <material name="black_tr">
        <color rgba="0.05 0.05 0.05 0.5" />
    </material>
    <material name="red">
        <color rgba="0.5 0.00 0.00 1.0" />
    </material>
    <material name="orange">
        <color rgba="1.0 0.4 0.0 1.0" />
    </material>

    <!-- ===================== -->
    <!-- Base box              -->
    <!-- ===================== -->
    <link name="base_link">
        <visual>
            <geometry>
                <box size="0.035 0.06 0.035" />
            </geometry>
            <material name="black_tr" />
        </visual>
    </link>
    <!-- ===================== -->
    <!-- Base axis (dummy) -->
    <!-- ===================== -->
    <link name="base_axis">
        <visual>
            <geometry>
                <cylinder radius="0.002" length="0.08" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="base_axis_to_base_link" type="fixed">
        <parent link="base_link" />
        <child link="base_axis" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0 0 0.035" rpy="-1.570796327 0 0" />
    </joint>
    <!-- ===================== -->
    <!-- Servo 1 axis (dummy) -->
    <!-- ===================== -->
    <link name="servo_1_axis">
        <visual>
            <geometry>
                <cylinder radius="0.002" length="0.08" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="joint1" type="revolute">
        <parent link="base_axis" />
        <child link="servo_1_axis" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0. 0 0" rpy="0 0 0" />
        <axis xyz="0 0 1" />
        <limit lower="-1.57" upper="1.57" effort="1" velocity="1" />
    </joint>
    <!-- ===================== -->
    <!-- Servo 1               -->
    <!-- ===================== -->
    <link name="servo_1">
        <visual>
            <geometry>
                <box size="${servo_size}" />
            </geometry>
            <material name="black" />
        </visual>
    </link>

    <joint name="base_to_servo_1" type="fixed">
        <parent link="servo_1_axis" />
        <child link="servo_1" />
        <!-- mounted on the side of the base -->
        <origin xyz="0.00 -0.011375 0.0" rpy="1.570796327 0 0" />
        <axis xyz="0 1 0" />
        <limit lower="-1.57" upper="1.57" effort="1" velocity="1" />
    </joint>

    <!-- ===================== -->
    <!-- Plate 1 (side-mounted) -->
    <!-- ===================== -->
    <link name="plate_1">
        <visual>
            <geometry>
                <box size="${plate_size}" />
            </geometry>
            <material name="orange" />
        </visual>
    </link>

    <joint name="servo_1_to_plate_1" type="fixed">
        <parent link="servo_1" />
        <child link="plate_1" />
        <!-- plate flush with servo side (sandwich-style) -->
        <origin xyz="0.0 0.0185 0.0475" rpy="0 0 0" />
    </joint>

    <!-- ===================== -->
    <!-- Plate 2 (side-mounted) -->
    <!-- ===================== -->
    <link name="plate_2">
        <visual>
            <geometry>
                <box size="${plate_size}" />
            </geometry>
            <material name="orange" />
        </visual>
    </link>

    <joint name="servo_1_to_plate_2" type="fixed">
        <parent link="servo_1" />
        <child link="plate_2" />
        <!-- plate flush with servo side (sandwich-style) -->
        <origin xyz="0 -0.0185 0.0475" rpy="0 0 0" />
    </joint>

    <!-- ===================== -->
    <!-- Servo 2               -->
    <!-- ===================== -->
    <link name="servo_2">
        <visual>
            <geometry>
                <box size="${servo_size}" />
            </geometry>
            <material name="black" />
        </visual>
    </link>

    <joint name="plate_1_to_servo_2" type="fixed">
        <parent link="plate_1" />
        <child link="servo_2" />
        <origin xyz="0.0175 -0.0185 0.0425" rpy="0 -1.570796327 0" />
    </joint>

    <!-- ===================== -->
    <!-- Servo 2 axis (dummy) -->
    <!-- ===================== -->
    <link name="servo_2_axis">
        <visual>
            <geometry>
                <cylinder radius="0.002" length="0.08" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="servo_2_axis_to_servo_2" type="fixed">
        <parent link="servo_2" />
        <child link="servo_2_axis" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0 0 -0.011375" rpy="-1.570796327 0 0" />
    </joint>

    
    <!-- ===================== -->
    <!-- Plate 3 (side-mounted) -->
    <!-- ===================== -->
    <link name="plate_3">
        <visual>
            <geometry>
                <box size="${plate_size}" />
            </geometry>
            <material name="orange" />
        </visual>
    </link>

    <joint name="plate_3_axis_to_plate_3" type="fixed">
        <parent link="plate_3_axis" />
        <child link="plate_3" />
        <origin xyz="-0.0425 0 0.0185" rpy="-1.570796327 0 -1.570796327" />
    </joint>
    <!-- ===================== -->
    <!-- Servo 3               -->
    <!-- ===================== -->
    <link name="servo_3">
        <visual>
            <geometry>
                <box size="${servo_size}" />
            </geometry>
            <material name="black" />
        </visual>
    </link>

    <joint name="plate_3_to_servo_3" type="fixed">
        <parent link="plate_3" />
        <child link="servo_3" />
        <origin xyz="0 0.0185 -0.0425" rpy="0 0 0" />
    </joint>
    !-- ===================== -->
    <!-- Plate 4 (side-mounted) -->
    <!-- ===================== -->
    <link name="plate_4">
        <visual>
            <geometry>
                <box size="${plate_size}" />
            </geometry>
            <material name="orange" />
        </visual>
    </link>

    <joint name="servo_3_axis_to_plate_4" type="fixed">
        <parent link="servo_3" />
        <child link="plate_4" />
        <origin xyz="0 0.0185 0.0425" rpy="0 0 0" />
    </joint>

    <!-- ===================== -->
    <!-- Servo 3 axis (dummy) -->
    <!-- ===================== -->
    <link name="servo_3_axis">
        <visual>
            <geometry>
                <cylinder radius="0.002" length="0.08" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="servo_3_to_servo_3_axis" type="fixed">
        <parent link="servo_3" />
        <child link="servo_3_axis" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0.00 0 -0.01137" rpy="0 -1.570796327 0" />
    </joint>

    <!-- ===================== -->
    <!-- Plate 3 axis (dummy) -->
    <!-- ===================== -->
    <link name="plate_3_axis">
        <visual>
            <geometry>
                <cylinder radius="0.002" length="0.08" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="joint2" type="revolute">
        <parent link="servo_2_axis" />
        <child link="plate_3_axis" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0.00 0 0.00" rpy="0 0 -1.570796327" />
        <axis xyz="0 0 1" />
        <limit lower="-1.57" upper="1.57" effort="1" velocity="1" />
    </joint>

    <!-- ===================== -->
    <!-- Gripper Gear (dummy) -->
    <!-- ===================== -->
    <link name="gripper_gear">
        <visual>
            <geometry>
                <cylinder radius="0.04" length="0.02" />
            </geometry>
            <material name="red" />
        </visual>
    </link>


    <joint name="joint3" type="revolute">
        <parent link="servo_3_axis" />
        <child link="gripper_gear" />
        <!-- offset so rotation is not through servo center -->
        <origin xyz="0.00 0 0.027" rpy="0 0 -1.570796327" />
        <axis xyz="0 0 1" />
        <limit lower="-1.57" upper="1.57" effort="1" velocity="1" />
    </joint>

    <xacro:include filename="$(find waveshare_servos)/description/ros2_control/crawler_arm.ros2_control.xacro"/>

    <xacro:crawler_arm_ws_ros2_control name="crawler_arm_ws_ros2_control" prefix="$(arg prefix)"/>

</robot>